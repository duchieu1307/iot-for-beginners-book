== Thiết kế ứng dụng

Trong phần này chúng ta sẽ xây dựng ứng dụng đọc nhiệt độ, độ ẩm của môi trường dùng cảm biến DHT11. Project sẽ chia làm 3 phần nhỏ để giúp bạn hiểu được cách hoạt động theo cơ chế server-client của esp8266.

. Mô hình với esp8266 là server có chức năng lấy dữ liệu từ DHT11 và tạo 1 web server. Web browser là client sẽ truy cập đến địa chỉ URL esp8266 đã thiết lập để lấy dữ liệu và hiển thị.
. Esp8266 là client , máy tính là server (dùng nodejs để tạo server). Kết quả nhiệt độ, độ ẩm sẽ được lấy từ esp8266 và gửi lên máy tính để hiển thị.
. Cả esp8266 và web browser đều đóng vai trò là client, máy tính là server (dùng nodejs). Dữ liệu thu được từ DHT11 sẽ được esp8266 gửi lên server, web browser sẽ lấy dữ liệu từ server và hiển thị lên web.

=== Yêu cầu

**Linh kiện**

* [x] Cảm biến DHT11
* [x] Board esp8266 Wifi Uno
* [x] Dây nối male-female header
* [x] Điện trở 5K Ohm
* [x] Cable kết nối giữa board esp8266 và máy tính

**Kiến thức**

Sẽ dễ dàng hơn nếu chúng ta có những kiến thức cơ bản về

* Chuẩn truyền dữ liệu 1 wire giữa các IC
* Ngôn ngữ javascript để xây dựng server bằng cách dùng Nodejs
* Ngôn ngữ html để xây dựng 1 trang web đơn giản nhằm hiển thị dữ liệu

Tuy nhiên cũng đừng quá lo lắng nếu bạn chưa từng nghe đến những thứ này, chúng ta sẽ hiểu nó khi đọc các phần tiếp theo.

Cảm biến DHT 11 và chuẩn dữ liệu 1 wire

* DHT11 là cảm biến có chức năng đo nhiệt độ, độ ẩm của môi trường, được dùng khá phổ biến vì giá thành thấp và độ ổn định cao.
  Cảm biến sử dụng chuẩn truyền dữ liệu 1 wire. Thông tin chi tiết về DHT có thể xem tại http://www.micropik.com/PDF/dht11.pdf[*Datasheet*]

* 1 wire là chuẩn giao tiếp nối tiếp được thiết kế bởi hãng Dallas. Đó là hệ thống bus nhằm kết nối các thiết bị với nhau để truyền hoặc nhận dữ liệu.
  Trong chuẩn giao tiếp này thường chỉ sử dụng 1 chân đồng thời là vừa là nguồn cung cấp vừa là chân truyền nhận dữ liệu.
  Cũng giống như các chuẩn giao tiếp khác, 1 wire cũng gồm 3 giai đoạn reqquest (hỏi) -> respond (đáp) -> data reading (truyền nhận dữ liệu).

Hình ảnh mô tả quá trình truyền,nhận dữ liệu của DHT11 như hình bên dưới

.Quá trình truyền nhận dữ liệu trong chuẩn 1 wire
image::04-dht11/DHT11TimingDialog.png[width=981, align="center"]

**Tóm tắt**

  . Master (esp8266) gửi tín hiệu START, DHT11 sẽ chuyển từ chế độ tiết kiệm năng lượng (low-power mode) sang chế độ làm việc bình thường (high-speed mode)

  . DHT11 nhận được tín hiệu và phản hồi đến master, master nhận tín hiệu và bắt đầu quá trình truyền dữ liệu.

  . DHT11 sẽ gửi dữ liệu lên bus, mỗi lần gửi là 1 gói 40 bits data.

  . Khi muốn kết thúc, Master sẽ gửi tín hiệu STOP, kết thúc quá trình truyền nhận dữ liệu

Chi tiết về chuẩn 1 wire xem tại https://www.maximintegrated.com/en/app-notes/index.mvp/id/1796[*maximintegrated.com*]

=== Hướng phát triển
Xây dựng 1 dự án giám sát và điều khiển nhiệt độ, độ ẩm hiển thị trên web với giao diện điều khiển :

* Hiển thị giá trị nhiệt độ, độ ẩm.
* Hiển thị chart nhiệt độ, độ ẩm theo thời gian.
* Có 2 chế độ Auto và Manual.
    + Với chế độ Auto, nhiệt độ > 35ºC sẽ tự động bật quạt, độ ẩm > 50% sẽ bật máy phun sương.
    + Với chế độ manual có thể điều khiển quạt và máy phun sương bằng các nút nhấn ở ON/OFF
* Có tùy chọn hiển thị lịch sử nhiệt độ, độ ẩm theo thời gian từ ngày aa/bb/cccc đến ngày xx/yy/zzzz

Hình ảnh thiết kế giao diện như bên dưới:

.Giao diện điều khiển trên trang html
image::04-dht11/control interface.png[width=822, align="center"]
=== Thực hiện

**Đấu nối**

Kết nối sơ đồ mạch điện như hình bên dưới

.Kết nối DHT11 và Esp8266 Wifi Uno
image::04-dht11/DHT11Connect.png[width=822, align="center"]
