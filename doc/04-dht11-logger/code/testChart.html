<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>DHT11</title>
</head>

<body>
    <h1> 1. Cập nhật giá trị nhiệt độ, độ ẩm ở textbox</h><br>
    <h2> Temprature</h2> <input type="text" size="6" id="temp">&#176;C<br>
    <h2> Humidity</h2> <input type="text" size="6" id="humd">%<br>
    <h1>2. Đồ thị nhiệt độ, độ ẩm</h1><br>
    <script type="text/javascript">
        function httpGetAsync(theUrl, callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function() {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                    callback(JSON.parse(xmlHttp.responseText));
            }
            xmlHttp.open("GET", theUrl, true); // true for asynchronous
            xmlHttp.send(null);
        }
        window.onload = function() {
            var dataTemmp = []; // dataPoints
            var chart = new CanvasJS.Chart("chartContainer", {
                title: {
                    text: "Humidity"
                },
                axisX: {
                    title: "chart updates every 2 secs"
                },
                data: [{
                    type: "line",
                    dataPoints: dataTemmp
                }]
            });
            var xVal = 0;
            var yHumdVal = 100;
            var updateInterval = 2000;
            var dataLength = 50; // number of dataPoints visible at any point
            var updateChart = function(count) {
                count = count || 1; // count is number of times loop runs to generate random dataPoints.

                httpGetAsync('/get', function(data) {
                    document.getElementById("temp").value = data[0].temp;
                    document.getElementById("humd").value = data[0].humd;
                    console.log(data);
                    for (var j = 0; j < count; j++) {
                        yHumdVal = parseInt(data[0].humd);
                        dataTemmp.push({
                            x: xVal,
                            y: yHumdVal
                        });
                        xVal++;
                    };
                    if (dataTemmp.length > dataLength) dataTemmp.shift();
                    chart.render();
                });
            };
            updateChart(dataLength);
            setInterval(function() {
                updateChart()
            }, updateInterval);
        }
    </script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <div id="chartContainer" style="height: 300px; width:50%;"></div>
</body>

</html>
